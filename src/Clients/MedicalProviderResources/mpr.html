<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Provider Resources Network Diagram</title>
    <link rel="stylesheet" href="../../styles/main.css">
    <style>
        .header-bar {
            display: flex;
            align-items: center;
            padding: 16px 24px;
            background: #f4f8fb;
            border-bottom: 1px solid #e0e7ef;
        }
        .back-btn {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            background: #3498db;
            color: #fff;
            cursor: pointer;
            text-decoration: none;
            margin-right: 24px;
            transition: background 0.2s;
        }
        .back-btn:hover {
            background: #217dbb;
        }
        .header-title {
            font-size: 22px;
            color: #333;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <a class="back-btn" href="../../index.html">‚Üê Back to Home</a>
        <span class="header-title">Medical Provider Resources Network Diagram</span>
    </div>
    <div id="root"></div>
    <div id="edit-modal" style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%); background:#fff; border:1px solid #3498db; border-radius:8px; padding:20px; z-index:2000; box-shadow:0 4px 16px rgba(0,0,0,0.15);">
      <form id="edit-form">
        <label>Hostname: <input type="text" id="edit-hostname"></label><br><br>
        <label>Serial: <input type="text" id="edit-serial"></label><br><br>
        <label>IP: <input type="text" id="edit-ip"></label><br><br>
        <button type="submit">Save</button>
        <button type="button" id="edit-cancel">Cancel</button>
      </form>
    </div>
    <div id="vm-modal" style="display:none; position:fixed; top:30%; left:50%; transform:translateX(-50%); background:#fff; border:1px solid #3498db; border-radius:8px; padding:20px; z-index:3000; box-shadow:0 4px 16px rgba(0,0,0,0.15);">
      <h3>VMs for Host</h3>
      <ul id="vm-list"></ul>
      <button type="button" id="vm-close">Close</button>
    </div>
    <script>
      document.getElementById('root').innerHTML = `
        <svg width="900" height="400">
          <!-- Office 1 Devices (remove data-model) -->
          <rect x="180" y="80" width="80" height="32" class="firewall" stroke="#333" stroke-width="2"
            data-hostname="FW-Office1" data-serial="FW111" data-ip="10.0.1.1"/>
          <text x="220" y="102" text-anchor="middle" font-size="14">Firewall</text>
          <rect x="80" y="150" width="80" height="32" class="switch" stroke="#333" stroke-width="2"
            data-hostname="SW1-Office1" data-serial="SW101" data-ip="10.0.1.2"/>
          <text x="120" y="172" text-anchor="middle" font-size="14">Switch 1</text>
          <rect x="180" y="150" width="80" height="32" class="switch" stroke="#333" stroke-width="2"
            data-hostname="SW2-Office1" data-serial="SW102" data-ip="10.0.1.3"/>
          <text x="220" y="172" text-anchor="middle" font-size="14">Switch 2</text>
          <rect x="280" y="150" width="80" height="32" class="switch" stroke="#333" stroke-width="2"
            data-hostname="SW3-Office1" data-serial="SW103" data-ip="10.0.1.4"/>
          <text x="320" y="172" text-anchor="middle" font-size="14">Switch 3</text>
          <rect x="180" y="210" width="60" height="28" class="host" stroke="#333" stroke-width="2"
            data-hostname="Host1-Office1" data-serial="HOST001" data-ip="10.0.1.10"/>
          <text x="210" y="228" text-anchor="middle" font-size="12">Host</text>
          <rect x="160" y="260" width="40" height="22" class="vm vm-host1" stroke="#333" stroke-width="2"
            data-hostname="VM1-Office1" data-serial="VM101" data-ip="10.0.1.20"/>
          <text x="180" y="275" text-anchor="middle" font-size="11" class="vm-label">VM 1</text>
          <rect x="220" y="260" width="40" height="22" class="vm vm-host1" stroke="#333" stroke-width="2"
            data-hostname="VM2-Office1" data-serial="VM102" data-ip="10.0.1.21"/>
          <text x="240" y="275" text-anchor="middle" font-size="11" class="vm-label">VM 2</text>
          <!-- Office 2 Devices (remove data-model) -->
          <rect x="620" y="80" width="80" height="32" class="firewall" stroke="#333" stroke-width="2"
            data-hostname="FW-Office2" data-serial="FW211" data-ip="10.0.2.1"/>
          <text x="660" y="102" text-anchor="middle" font-size="14">Firewall</text>
          <rect x="620" y="150" width="80" height="32" class="switch" stroke="#333" stroke-width="2"
            data-hostname="SW1-Office2" data-serial="SW201" data-ip="10.0.2.2"/>
          <text x="660" y="172" text-anchor="middle" font-size="14">Switch</text>
          <ellipse cx="660" cy="230" rx="35" ry="20" class="access-point" stroke="#333" stroke-width="2"
            data-hostname="AP1-Office2" data-serial="AP201" data-ip="10.0.2.101"/>
          <text x="660" y="235" text-anchor="middle" font-size="13">AP</text>
          <!-- Site-to-Site VPN Connection -->
          <line x1="220" y1="96" x2="660" y2="96" stroke="#27ae60" stroke-width="3" stroke-dasharray="10,7"/>
          <text x="440" y="86" text-anchor="middle" font-size="13" fill="#27ae60">Site-to-Site VPN</text>
        </svg>
      `;

      // Tooltip logic
      if (!document.getElementById('tooltip')) {
        const tooltipDiv = document.createElement('div');
        tooltipDiv.id = 'tooltip';
        tooltipDiv.style.position = 'absolute';
        tooltipDiv.style.display = 'none';
        tooltipDiv.style.background = '#fff';
        tooltipDiv.style.border = '1px solid #3498db';
        tooltipDiv.style.borderRadius = '6px';
        tooltipDiv.style.padding = '8px 12px';
        tooltipDiv.style.fontSize = '14px';
        tooltipDiv.style.color = '#333';
        tooltipDiv.style.boxShadow = '0 2px 8px rgba(0,0,0,0.12)';
        tooltipDiv.style.pointerEvents = 'none';
        tooltipDiv.style.zIndex = '1000';
        document.body.appendChild(tooltipDiv);
      }
      const tooltip = document.getElementById('tooltip');
      const svg = document.querySelector('svg');

      svg.addEventListener('mousemove', function(e) {
        const target = e.target;
        if (target.dataset && target.dataset.hostname) {
          tooltip.style.display = 'block';
          tooltip.innerHTML = `
            <strong>Hostname:</strong> ${target.dataset.hostname}<br>
            <strong>Serial:</strong> ${target.dataset.serial}<br>
            <strong>IP:</strong> ${target.dataset.ip}
          `;
          tooltip.style.left = (e.pageX + 12) + 'px';
          tooltip.style.top = (e.pageY + 12) + 'px';
        } else {
          tooltip.style.display = 'none';
        }
      });

      svg.addEventListener('mouseleave', function() {
        tooltip.style.display = 'none';
      });

      // Edit modal logic
      const editModal = document.getElementById('edit-modal');
      const editForm = document.getElementById('edit-form');

      svg.addEventListener('dblclick', function(e) {
        const target = e.target;
        if (target.dataset && target.dataset.hostname) {
          document.getElementById('edit-hostname').value = target.dataset.hostname;
          document.getElementById('edit-serial').value = target.dataset.serial;
          document.getElementById('edit-ip').value = target.dataset.ip;
          editModal.style.display = 'block';
          editModal.style.left = (e.pageX - 100) + 'px';
          editModal.style.top = (e.pageY - 100) + 'px';
          // Store reference to the node being edited
          editModal.dataset.targetId = target.dataset.hostname + target.dataset.serial + target.dataset.ip;
          editModal.dataset.targetType = target.tagName;
        }
      });

      document.getElementById('edit-cancel').addEventListener('click', function() {
        editModal.style.display = 'none';
      });

      editForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const hostname = document.getElementById('edit-hostname').value;
        const serial = document.getElementById('edit-serial').value;
        const ip = document.getElementById('edit-ip').value;

        // Find the node being edited by matching attributes
        const targetElement = Array.from(svg.querySelectorAll('[data-hostname]')).find(el =>
          el.dataset.hostname === hostname ||
          el.dataset.serial === serial ||
          el.dataset.ip === ip
        );
        if (targetElement) {
          targetElement.dataset.hostname = hostname;
          targetElement.dataset.serial = serial;
          targetElement.dataset.ip = ip;
          tooltip.innerHTML = `
            <strong>Hostname:</strong> ${targetElement.dataset.hostname}<br>
            <strong>Serial:</strong> ${targetElement.dataset.serial}<br>
            <strong>IP:</strong> ${targetElement.dataset.ip}
          `;
        }
        editModal.style.display = 'none';
      });

      const host = svg.querySelector('.host');
      const vms = svg.querySelectorAll('.vm');
      const vmModal = document.getElementById('vm-modal');
      const vmList = document.getElementById('vm-list');
      const vmClose = document.getElementById('vm-close');

      host.addEventListener('click', function() {
        // Clear previous list
        vmList.innerHTML = '';
        // Find VMs related to this host (by class, e.g. vm-host1)
        vms.forEach(vm => {
          // You can filter by class if you have multiple hosts
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>Hostname:</strong> ${vm.dataset.hostname}<br>
            <strong>Serial:</strong> ${vm.dataset.serial}<br>
            <strong>IP:</strong> ${vm.dataset.ip}
          `;
          vmList.appendChild(li);
        });
        vmModal.style.display = 'block';
      });

      vmClose.addEventListener('click', function() {
        vmModal.style.display = 'none';
      });
    </script>
</body>
</html>