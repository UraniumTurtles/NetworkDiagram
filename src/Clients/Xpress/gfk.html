<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xpress GFK Network Diagram</title>
    <link rel="stylesheet" href="../../styles/main.css">
</head>
<body>
    <div class="header-bar">
        <a class="back-btn" href="../../index.html">‚Üê Back to Home</a>
        <span class="header-title">Xpress GFK Network Diagram</span>
    </div>
    <div id="root"></div>
    <div id="edit-modal" style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%); background:#fff; border:1px solid #3498db; border-radius:8px; padding:20px; z-index:2000; box-shadow:0 4px 16px rgba(0,0,0,0.15);">
      <form id="edit-form">
        <label>Hostname: <input type="text" id="edit-hostname"></label><br><br>
        <label>Serial: <input type="text" id="edit-serial"></label><br><br>
        <label>IP: <input type="text" id="edit-ip"></label><br><br>
        <button type="submit">Save</button>
        <button type="button" id="edit-cancel">Cancel</button>
      </form>
    </div>
    <div id="vm-modal" style="display:none; position:fixed; top:30%; left:50%; transform:translateX(-50%); background:#fff; border:1px solid #3498db; border-radius:8px; padding:20px; z-index:3000; box-shadow:0 4px 16px rgba(0,0,0,0.15);">
      <h3>VMs for Host</h3>
      <ul id="vm-list"></ul>
      <button type="button" id="vm-close">Close</button>
    </div>
    <script>
      document.getElementById('root').innerHTML = `
        <svg width="900" height="400">
          <!-- Container -->
          <rect x="40" y="60" width="820" height="320" fill="#f8faff" stroke="#b3c6e0" stroke-width="2"/>
          <text x="450" y="55" text-anchor="middle" font-size="18" font-weight="bold">Xpress GFK Office</text>

          <!-- Connection lines -->
          <line x1="450" y1="100" x2="450" y2="150" />
          <line x1="450" y1="182" x2="350" y2="210" />
          <line x1="450" y1="182" x2="550" y2="210" />
          <line x1="450" y1="182" x2="750" y2="270" />

          <!-- Devices -->
          <rect x="410" y="70" width="80" height="32" class="firewall" stroke="#333" stroke-width="2"
            data-hostname="GFK-64-Envision" data-serial="FW001" data-ip="192.168.54.1" data-model="SonicWall TZ370"/>
          <text x="450" y="92" text-anchor="middle" font-size="14">Firewall</text>
          <rect x="410" y="150" width="80" height="32" class="switch" stroke="#333" stroke-width="2"
            data-hostname="SW-GFK" data-serial="SW001" data-ip="10.1.1.2" data-model=""/>
          <text x="450" y="172" text-anchor="middle" font-size="14">Switch</text>
          <ellipse cx="750" cy="270" rx="35" ry="20" class="access-point" stroke="#333" stroke-width="2"
            data-hostname="GFK-AP1" data-serial="" data-ip="192.168.64.101" data-model="AP-535"/>
          <text x="750" y="275" text-anchor="middle" font-size="13">AP</text>

          <!-- Hosts together -->
          <rect x="310" y="210" width="80" height="32" class="host" stroke="#333" stroke-width="2"
            data-hostname="Host1-GFK" data-serial="HOST001" data-ip="10.1.1.10" data-model=""/>
          <text x="350" y="232" text-anchor="middle" font-size="12">Host 1</text>
          <rect x="510" y="210" width="80" height="32" class="host" stroke="#333" stroke-width="2"
            data-hostname="Host2-GFK" data-serial="HOST002" data-ip="10.1.1.11" data-model=""/>
          <text x="550" y="232" text-anchor="middle" font-size="12">Host 2</text>

          <!-- VMs for Host 1 -->
          <rect x="330" y="260" width="40" height="22" class="vm vm-host1" stroke="#333" stroke-width="2"
            data-hostname="VM1-GFK" data-serial="VM001" data-ip="10.1.1.20" data-model=""/>
          <text x="350" y="275" text-anchor="middle" font-size="11" class="vm-label">VM 1</text>

          <!-- VMs for Host 2 -->
          <rect x="530" y="260" width="40" height="22" class="vm vm-host2" stroke="#333" stroke-width="2"
            data-hostname="VM2-GFK" data-serial="VM002" data-ip="10.1.1.21" data-model=""/>
          <text x="550" y="275" text-anchor="middle" font-size="11" class="vm-label">VM 2</text>
          <rect x="580" y="260" width="40" height="22" class="vm vm-host2" stroke="#333" stroke-width="2"
            data-hostname="VM3-GFK" data-serial="VM003" data-ip="10.1.1.22" data-model=""/>
          <text x="600" y="275" text-anchor="middle" font-size="11" class="vm-label">VM 3</text>
        </svg>
      `;

      // Tooltip logic
      if (!document.getElementById('tooltip')) {
        const tooltipDiv = document.createElement('div');
        tooltipDiv.id = 'tooltip';
        tooltipDiv.style.position = 'absolute';
        tooltipDiv.style.display = 'none';
        tooltipDiv.style.background = '#fff';
        tooltipDiv.style.border = '1px solid #3498db';
        tooltipDiv.style.borderRadius = '6px';
        tooltipDiv.style.padding = '8px 12px';
        tooltipDiv.style.fontSize = '14px';
        tooltipDiv.style.color = '#333';
        tooltipDiv.style.boxShadow = '0 2px 8px rgba(0,0,0,0.12)';
        tooltipDiv.style.pointerEvents = 'none';
        tooltipDiv.style.zIndex = '1000';
        document.body.appendChild(tooltipDiv);
      }
      const tooltip = document.getElementById('tooltip');
      const svg = document.querySelector('svg');

      svg.addEventListener('mousemove', function(e) {
        const target = e.target;
        if (target.dataset && target.dataset.hostname) {
          tooltip.style.display = 'block';
          tooltip.innerHTML = `
            <strong>Hostname:</strong> ${target.dataset.hostname}<br>
            <strong>Model:</strong> ${target.dataset.model || ''}<br>
            <strong>Serial:</strong> ${target.dataset.serial}<br>
            <strong>IP:</strong> ${target.dataset.ip}
          `;
          tooltip.style.left = (e.pageX + 12) + 'px';
          tooltip.style.top = (e.pageY + 12) + 'px';
        } else {
          tooltip.style.display = 'none';
        }
      });

      svg.addEventListener('mouseleave', function() {
        tooltip.style.display = 'none';
      });

      // Edit modal logic
      const editModal = document.getElementById('edit-modal');
      const editForm = document.getElementById('edit-form');

      svg.addEventListener('dblclick', function(e) {
        const target = e.target;
        if (target.dataset && target.dataset.hostname) {
          document.getElementById('edit-hostname').value = target.dataset.hostname;
          document.getElementById('edit-serial').value = target.dataset.serial;
          document.getElementById('edit-ip').value = target.dataset.ip;
          editModal.style.display = 'block';
          editModal.style.left = (e.pageX - 100) + 'px';
          editModal.style.top = (e.pageY - 100) + 'px';
        }
      });

      document.getElementById('edit-cancel').addEventListener('click', function() {
        editModal.style.display = 'none';
      });

      editForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const hostname = document.getElementById('edit-hostname').value;
        const serial = document.getElementById('edit-serial').value;
        const ip = document.getElementById('edit-ip').value;
        const targetElement = Array.from(svg.querySelectorAll('[data-hostname]')).find(el =>
          el.dataset.hostname === hostname ||
          el.dataset.serial === serial ||
          el.dataset.ip === ip
        );
        if (targetElement) {
          targetElement.dataset.hostname = hostname;
          targetElement.dataset.serial = serial;
          targetElement.dataset.ip = ip;
          tooltip.innerHTML = `
            <strong>Hostname:</strong> ${targetElement.dataset.hostname}<br>
            <strong>Serial:</strong> ${targetElement.dataset.serial}<br>
            <strong>IP:</strong> ${targetElement.dataset.ip}
          `;
        }
        editModal.style.display = 'none';
      });

      // VM modal logic
      const host1 = svg.querySelector('.host[data-hostname="Host1-GFK"]');
      const host2 = svg.querySelector('.host[data-hostname="Host2-GFK"]');
      const vmModal = document.getElementById('vm-modal');
      const vmList = document.getElementById('vm-list');
      const vmClose = document.getElementById('vm-close');

      host1.addEventListener('click', function() {
        vmList.innerHTML = '';
        svg.querySelectorAll('.vm-host1').forEach(vm => {
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>Hostname:</strong> ${vm.dataset.hostname}<br>
            <strong>Serial:</strong> ${vm.dataset.serial}<br>
            <strong>IP:</strong> ${vm.dataset.ip}
          `;
          vmList.appendChild(li);
        });
        vmModal.style.display = 'block';
      });

      host2.addEventListener('click', function() {
        vmList.innerHTML = '';
        svg.querySelectorAll('.vm-host2').forEach(vm => {
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>Hostname:</strong> ${vm.dataset.hostname}<br>
            <strong>Serial:</strong> ${vm.dataset.serial}<br>
            <strong>IP:</strong> ${vm.dataset.ip}
          `;
          vmList.appendChild(li);
        });
        vmModal.style.display = 'block';
      });

      vmClose.addEventListener('click', function() {
        vmModal.style.display = 'none';
      });
    </script>
</body>
</html>